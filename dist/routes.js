"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

var _koaRouter = _interopRequireDefault(require("koa-router"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const getNextId = () => Number(_lodash.default.uniqueId());

var _default = (router, io) => {
  const generalChannelId = getNextId();
  const randomChannelId = getNextId();
  const defaultState = {
    channels: [{
      id: generalChannelId,
      name: 'general',
      removable: false
    }, {
      id: randomChannelId,
      name: 'random',
      removable: false
    }],
    messages: [],
    currentChannelId: generalChannelId
  };
  const state = { ...defaultState
  };
  const apiRouter = new _koaRouter.default();
  apiRouter.get('/channels', ctx => {
    ctx.body = state.channels;
  }).post('/channels', ctx => {
    const {
      data: {
        attributes: {
          name
        }
      }
    } = ctx.request.body;
    const channel = {
      name,
      removable: true,
      id: getNextId()
    };
    state.channels.push(channel);
    ctx.status = 201;
    const data = {
      data: {
        type: 'channels',
        id: channel.id,
        attributes: channel
      }
    };
    ctx.body = data;
    io.emit('newChannel', data);
  }).delete('/channels/:id', ctx => {
    const channelId = Number(ctx.params.id);
    state.channels = state.channels.filter(c => c.id !== channelId);
    state.messages = state.messages.filter(m => m.channelId !== channelId);
    ctx.status = 204;
    const data = {
      data: {
        type: 'channels',
        id: channelId
      }
    };
    io.emit('removeChannel', data);
  }).patch('/channels/:id', ctx => {
    const channelId = Number(ctx.params.id);
    const channel = state.channels.find(c => c.id === channelId);
    const {
      attributes
    } = ctx.request.body.data;
    channel.name = attributes.name;
    ctx.status = 204;
    const data = {
      data: {
        type: 'channels',
        id: channelId,
        attributes: channel
      }
    };
    io.emit('renameChannel', data);
  }).get('/channels/:channelId/messages', ctx => {
    const messages = state.messages.filter(m => m.channelId === Number(ctx.params.channelId));
    const resources = messages.map(m => ({
      type: 'messages',
      id: m.id,
      attributes: m
    }));
    ctx.body = resources;
  }).post('/channels/:channelId/messages', ctx => {
    const {
      data: {
        attributes
      }
    } = ctx.request.body;
    const message = { ...attributes,
      channelId: Number(ctx.params.channelId),
      id: getNextId()
    };
    state.messages.push(message);
    ctx.status = 201;
    const data = {
      data: {
        type: 'messages',
        id: message.id,
        attributes: message
      }
    };
    ctx.body = data;
    io.emit('newMessage', data);
  });
  return router.get('root', '/', ctx => {
    ctx.render('index', {
      gon: state
    });
  }).use('/api/v1', apiRouter.routes(), apiRouter.allowedMethods());
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NlcnZlci9yb3V0ZXMuanMiXSwibmFtZXMiOlsiZ2V0TmV4dElkIiwiTnVtYmVyIiwiXyIsInVuaXF1ZUlkIiwicm91dGVyIiwiaW8iLCJnZW5lcmFsQ2hhbm5lbElkIiwicmFuZG9tQ2hhbm5lbElkIiwiZGVmYXVsdFN0YXRlIiwiY2hhbm5lbHMiLCJpZCIsIm5hbWUiLCJyZW1vdmFibGUiLCJtZXNzYWdlcyIsImN1cnJlbnRDaGFubmVsSWQiLCJzdGF0ZSIsImFwaVJvdXRlciIsIlJvdXRlciIsImdldCIsImN0eCIsImJvZHkiLCJwb3N0IiwiZGF0YSIsImF0dHJpYnV0ZXMiLCJyZXF1ZXN0IiwiY2hhbm5lbCIsInB1c2giLCJzdGF0dXMiLCJ0eXBlIiwiZW1pdCIsImRlbGV0ZSIsImNoYW5uZWxJZCIsInBhcmFtcyIsImZpbHRlciIsImMiLCJtIiwicGF0Y2giLCJmaW5kIiwicmVzb3VyY2VzIiwibWFwIiwibWVzc2FnZSIsInJlbmRlciIsImdvbiIsInVzZSIsInJvdXRlcyIsImFsbG93ZWRNZXRob2RzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxTQUFTLEdBQUcsTUFBTUMsTUFBTSxDQUFDQyxnQkFBRUMsUUFBRixFQUFELENBQTlCOztlQUVlLENBQUNDLE1BQUQsRUFBU0MsRUFBVCxLQUFnQjtBQUM3QixRQUFNQyxnQkFBZ0IsR0FBR04sU0FBUyxFQUFsQztBQUNBLFFBQU1PLGVBQWUsR0FBR1AsU0FBUyxFQUFqQztBQUNBLFFBQU1RLFlBQVksR0FBRztBQUNuQkMsSUFBQUEsUUFBUSxFQUFFLENBQ1I7QUFBRUMsTUFBQUEsRUFBRSxFQUFFSixnQkFBTjtBQUF3QkssTUFBQUEsSUFBSSxFQUFFLFNBQTlCO0FBQXlDQyxNQUFBQSxTQUFTLEVBQUU7QUFBcEQsS0FEUSxFQUVSO0FBQUVGLE1BQUFBLEVBQUUsRUFBRUgsZUFBTjtBQUF1QkksTUFBQUEsSUFBSSxFQUFFLFFBQTdCO0FBQXVDQyxNQUFBQSxT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LEVBQUUsRUFBRVYsU0FBUztBQUhDLEtBQWhCO0FBS0FlLElBQUFBLEtBQUssQ0FBQ0YsUUFBTixDQUFlYSxJQUFmLENBQW9CYyxPQUFwQjtBQUNBckIsSUFBQUEsR0FBRyxDQUFDUSxNQUFKLEdBQWEsR0FBYjtBQUNBLFVBQU1MLElBQUksR0FBRztBQUNYQSxNQUFBQSxJQUFJLEVBQUU7QUFDSk0sUUFBQUEsSUFBSSxFQUFFLFVBREY7QUFFSmxCLFFBQUFBLEVBQUUsRUFBRThCLE9BQU8sQ0FBQzlCLEVBRlI7QUFHSmEsUUFBQUEsVUFBVSxFQUFFaUI7QUFIUjtBQURLLEtBQWI7QUFPQXJCLElBQUFBLEdBQUcsQ0FBQ0MsSUFBSixHQUFXRSxJQUFYO0FBQ0FqQixJQUFBQSxFQUFFLENBQUN3QixJQUFILENBQVEsWUFBUixFQUFzQlAsSUFBdEI7QUFDRCxHQWhGSDtBQWtGQSxTQUFPbEIsTUFBTSxDQUNWYyxHQURJLENBQ0EsTUFEQSxFQUNRLEdBRFIsRUFDY0MsR0FBRCxJQUFTO0FBQ3pCQSxJQUFBQSxHQUFHLENBQUNzQixNQUFKLENBQVcsT0FBWCxFQUFvQjtBQUFFQyxNQUFBQSxHQUFHLEVBQUUzQjtBQUFQLEtBQXBCO0FBQ0QsR0FISSxFQUlKNEIsR0FKSSxDQUlBLFNBSkEsRUFJVzNCLFNBQVMsQ0FBQzRCLE1BQVYsRUFKWCxFQUkrQjVCLFNBQVMsQ0FBQzZCLGNBQVYsRUFKL0IsQ0FBUDtBQUtELEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFJvdXRlciBmcm9tICdrb2Etcm91dGVyJztcblxuY29uc3QgZ2V0TmV4dElkID0gKCkgPT4gTnVtYmVyKF8udW5pcXVlSWQoKSk7XG5cbmV4cG9ydCBkZWZhdWx0IChyb3V0ZXIsIGlvKSA9PiB7XG4gIGNvbnN0IGdlbmVyYWxDaGFubmVsSWQgPSBnZXROZXh0SWQoKTtcbiAgY29uc3QgcmFuZG9tQ2hhbm5lbElkID0gZ2V0TmV4dElkKCk7XG4gIGNvbnN0IGRlZmF1bHRTdGF0ZSA9IHtcbiAgICBjaGFubmVsczogW1xuICAgICAgeyBpZDogZ2VuZXJhbENoYW5uZWxJZCwgbmFtZTogJ2dlbmVyYWwnLCByZW1vdmFibGU6IGZhbHNlIH0sXG4gICAgICB7IGlkOiByYW5kb21DaGFubmVsSWQsIG5hbWU6ICdyYW5kb20nLCByZW1vdmFibGU6IGZhbHNlIH0sXG4gICAgXSxcbiAgICBtZXNzYWdlczogW10sXG4gICAgY3VycmVudENoYW5uZWxJZDogZ2VuZXJhbENoYW5uZWxJZCxcbiAgfTtcblxuICBjb25zdCBzdGF0ZSA9IHsgLi4uZGVmYXVsdFN0YXRlIH07XG5cbiAgY29uc3QgYXBpUm91dGVyID0gbmV3IFJvdXRlcigpO1xuICBhcGlSb3V0ZXJcbiAgICAuZ2V0KCcvY2hhbm5lbHMnLCAoY3R4KSA9PiB7XG4gICAgICBjdHguYm9keSA9IHN0YXRlLmNoYW5uZWxzO1xuICAgIH0pXG4gICAgLnBvc3QoJy9jaGFubmVscycsIChjdHgpID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogeyBhdHRyaWJ1dGVzOiB7IG5hbWUgfSB9IH0gPSBjdHgucmVxdWVzdC5ib2R5O1xuICAgICAgY29uc3QgY2hhbm5lbCA9IHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgcmVtb3ZhYmxlOiB0cnVlLFxuICAgICAgICBpZDogZ2V0TmV4dElkKCksXG4gICAgICB9O1xuICAgICAgc3RhdGUuY2hhbm5lbHMucHVzaChjaGFubmVsKTtcbiAgICAgIGN0eC5zdGF0dXMgPSAyMDE7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdHlwZTogJ2NoYW5uZWxzJyxcbiAgICAgICAgICBpZDogY2hhbm5lbC5pZCxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiBjaGFubmVsLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGN0eC5ib2R5ID0gZGF0YTtcblxuICAgICAgaW8uZW1pdCgnbmV3Q2hhbm5lbCcsIGRhdGEpO1xuICAgIH0pXG4gICAgLmRlbGV0ZSgnL2NoYW5uZWxzLzppZCcsIChjdHgpID0+IHtcbiAgICAgIGNvbnN0IGNoYW5uZWxJZCA9IE51bWJlcihjdHgucGFyYW1zLmlkKTtcbiAgICAgIHN0YXRlLmNoYW5uZWxzID0gc3RhdGUuY2hhbm5lbHMuZmlsdGVyKGMgPT4gYy5pZCAhPT0gY2hhbm5lbElkKTtcbiAgICAgIHN0YXRlLm1lc3NhZ2VzID0gc3RhdGUubWVzc2FnZXMuZmlsdGVyKG0gPT4gbS5jaGFubmVsSWQgIT09IGNoYW5uZWxJZCk7XG4gICAgICBjdHguc3RhdHVzID0gMjA0O1xuICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHR5cGU6ICdjaGFubmVscycsXG4gICAgICAgICAgaWQ6IGNoYW5uZWxJZCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBpby5lbWl0KCdyZW1vdmVDaGFubmVsJywgZGF0YSk7XG4gICAgfSlcbiAgICAucGF0Y2goJy9jaGFubmVscy86aWQnLCAoY3R4KSA9PiB7XG4gICAgICBjb25zdCBjaGFubmVsSWQgPSBOdW1iZXIoY3R4LnBhcmFtcy5pZCk7XG4gICAgICBjb25zdCBjaGFubmVsID0gc3RhdGUuY2hhbm5lbHMuZmluZChjID0+IGMuaWQgPT09IGNoYW5uZWxJZCk7XG5cbiAgICAgIGNvbnN0IHsgYXR0cmlidXRlcyB9ID0gY3R4LnJlcXVlc3QuYm9keS5kYXRhO1xuICAgICAgY2hhbm5lbC5uYW1lID0gYXR0cmlidXRlcy5uYW1lO1xuICAgICAgY3R4LnN0YXR1cyA9IDIwNDtcbiAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0eXBlOiAnY2hhbm5lbHMnLFxuICAgICAgICAgIGlkOiBjaGFubmVsSWQsXG4gICAgICAgICAgYXR0cmlidXRlczogY2hhbm5lbCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBpby5lbWl0KCdyZW5hbWVDaGFubmVsJywgZGF0YSk7XG4gICAgfSlcbiAgICAuZ2V0KCcvY2hhbm5lbHMvOmNoYW5uZWxJZC9tZXNzYWdlcycsIChjdHgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2VzID0gc3RhdGUubWVzc2FnZXMuZmlsdGVyKG0gPT4gbS5jaGFubmVsSWQgPT09IE51bWJlcihjdHgucGFyYW1zLmNoYW5uZWxJZCkpO1xuICAgICAgY29uc3QgcmVzb3VyY2VzID0gbWVzc2FnZXMubWFwKG0gPT4gKHtcbiAgICAgICAgdHlwZTogJ21lc3NhZ2VzJyxcbiAgICAgICAgaWQ6IG0uaWQsXG4gICAgICAgIGF0dHJpYnV0ZXM6IG0sXG4gICAgICB9KSk7XG4gICAgICBjdHguYm9keSA9IHJlc291cmNlcztcbiAgICB9KVxuICAgIC5wb3N0KCcvY2hhbm5lbHMvOmNoYW5uZWxJZC9tZXNzYWdlcycsIChjdHgpID0+IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogeyBhdHRyaWJ1dGVzIH0gfSA9IGN0eC5yZXF1ZXN0LmJvZHk7XG4gICAgICBjb25zdCBtZXNzYWdlID0ge1xuICAgICAgICAuLi5hdHRyaWJ1dGVzLFxuICAgICAgICBjaGFubmVsSWQ6IE51bWJlcihjdHgucGFyYW1zLmNoYW5uZWxJZCksXG4gICAgICAgIGlkOiBnZXROZXh0SWQoKSxcbiAgICAgIH07XG4gICAgICBzdGF0ZS5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgY3R4LnN0YXR1cyA9IDIwMTtcbiAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB0eXBlOiAnbWVzc2FnZXMnLFxuICAgICAgICAgIGlkOiBtZXNzYWdlLmlkLFxuICAgICAgICAgIGF0dHJpYnV0ZXM6IG1lc3NhZ2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY3R4LmJvZHkgPSBkYXRhO1xuICAgICAgaW8uZW1pdCgnbmV3TWVzc2FnZScsIGRhdGEpO1xuICAgIH0pO1xuXG4gIHJldHVybiByb3V0ZXJcbiAgICAuZ2V0KCdyb290JywgJy8nLCAoY3R4KSA9PiB7XG4gICAgICBjdHgucmVuZGVyKCdpbmRleCcsIHsgZ29uOiBzdGF0ZSB9KTtcbiAgICB9KVxuICAgIC51c2UoJy9hcGkvdjEnLCBhcGlSb3V0ZXIucm91dGVzKCksIGFwaVJvdXRlci5hbGxvd2VkTWV0aG9kcygpKTtcbn07XG4iXX0=